<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Defining a simple behavior &middot; MASSIS
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/tests_pages/public/css/poole.css">
  <link rel="stylesheet" href="/tests_pages/public/css/syntax.css">
  <link rel="stylesheet" href="/tests_pages/public/css/hyde.css">
  <link rel="stylesheet" href="/tests_pages/public/css/massis.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/tests_pages/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/tests_pages/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-massis">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/tests_pages/"><img src="http://i.imgur.com/SyxoguR.png" alt="MASSIS"></a>
      </h1>
      <p class="lead">MultiAgent System Simulation Framework for Indoor Scenarios</p>
    </div>

    <nav class="sidebar-nav">
      

      

      
      
        <a class="sidebar-nav-item" href="/tests_pages/">Home </a>
      
        <a class="sidebar-nav-item" href="/tests_pages/tutorials/">Tutorials </a>
      
        <a class="sidebar-nav-item" href="/tests_pages/blog/index.html">Blog </a>
      

      <a class="sidebar-nav-item" href="https://github.com/rpax/MASSIS/archive/v1.2.10.zip">Download</a>
      <a class="sidebar-nav-item" href="https://github.com/rpax/MASSIS">GitHub project</a>
      <span class="sidebar-nav-item">Currently v1.2.10</span>
    </nav>

    <p>&copy; 2016. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Defining a simple behavior</h1>
  <p>This is the continuation of the <a href="%5Btutorial_4%5D:">Second tutorial</a>.</p>

<p>In the previous tutorial, we learnt how to change properties of the elements of the environment and launching the simulation. In this tutorial, we will learn the basics of the simulation gui, and a simple example about how to manage the behavior of the agent in the environment.</p>

<h1 id="the-simulation-gui">The simulation GUI.</h1>

<p>In the previous tutorial, we executed <code>SimulationWithUILauncher</code>, and the following window appeared.Let&#39;s explain briefly the contents of this window.</p>

<ul>
<li><p>About : Shows some a welcome screen, and copyright imformation. The three buttons on the bottom-left side control the most basic functionalities of the simulator:</p>

<ul>
<li>Advance one step</li>
<li>Run continuously</li>
<li>Stop
<img src="http://i.imgur.com/kPN5EI7.png" alt=""></li>
</ul></li>
<li><p>Console : Controls simulation parameters.</p>

<ul>
<li>Delay (Sec/Step) : Delay between steps in the simulation</li>
<li>Steps per Step-button : Number of steps to be executed every time the play-pause button is pressed.
<img src="http://i.imgur.com/SI7dSrf.png" alt=""></li>
</ul></li>
<li><p>Displays: This tab offers different ways for visualizing the state of the simulation. They can be shown or hidden anytime, with the simulation running also.  <img src="http://i.imgur.com/PptfTUD.png" alt="">  There are three different types of visualization:</p>

<ul>
<li>Building map : Shows the 2D layer- based map. This is the most powerful, flexible and customizable visualization tool of MASSIS. This type of display is deeply explained in  . <img src="http://i.imgur.com/IcRLXtI.png" alt=""></li>
<li>Building 2D :  Shows SweetHome3D default 2D viewer. It is included because maybe it is useful in the future. Although it is not recommended: Is not optimized for the simulation, and has thread-safety issues.<img src="http://i.imgur.com/2tnx3mF.png" alt=""></li>
<li>Building 3D: Shows the 3D viewer. The camera can be controlled with the mouse or keyboard</li>
<li>Keyboard:

<ul>
<li><code>W</code> moves the camera backwards</li>
<li><code>S</code> moves the camera forward.</li>
<li><code>Caps lock</code> (&#8682;) makes the movement of the camera faster.</li>
</ul></li>
<li>Mouse:

<ul>
<li>The mouse wheel moves the camera backwards/forward</li>
<li>The mouse movement changes the view direction</li>
</ul></li>
</ul></li>
</ul>

<h1 id="first-run">First Run</h1>

<p>Ok, so let&#39;s press the <em>Play</em> (<img src="http://i.imgur.com/D6C9dta.png?1" alt="">) button. What happens?</p>

<ol>
<li>The <em>step counter</em> increases its value very fast</li>
<li><p>The output of the console is always the same:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Hey! I am an agent!
Hey! I am an agent!
Hey! I am an agent!
Hey! I am an agent!
Hey! I am an agent!
Hey! I am an agent!
Hey! I am an agent!
Hey! I am an agent!
Hey! I am an agent!
Hey! I am an agent!
Hey! I am an agent!
... etc
</code></pre></div></li>
<li><p>Nothing moves.</p></li>
</ol>

<p>Why? because the behavior of the agent, defined by its <em>High Level Controller</em> is exactly that.</p>

<h1 id="what-is-a-highlevelcontroller">What is a <em>HighLevelController</em> ?</h1>

<p>In MASSIS, the <em>High Level Controllers</em> manage the agent&#39;s behavior. In our case, the <code>MyHelloHighLevelController.java</code> file contains the following code.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">public class MyHelloHighLevelController extends HighLevelController {

    public MyHelloHighLevelController(
        /*1*/ LowLevelAgent agent,
        /*2*/ Map&lt;String, String&gt; metadata,
        /*3*/ String resourcesFolder) {

        super(agent, metadata, resourcesFolder);
        this.agent.setHighLevelData(this);
    }

    @Override
    public void stop() {
        /*4*/
        /*  Clean resources, threads...etc */
    }

    @Override
    public void step() {
        /*5*/
        System.out.println(&quot;Hey! I am an agent!&quot;);
    }
}
</code></pre></div>
<p>Let&#39;s explain it by parts (marked in the code between <code>/**/</code>)</p>

<ol>
<li><p>What is a <em>LowLevelAgent</em> ?</p>

<p>A <em>LowLevelAgent</em> is the element that provides the <em>HighLevelController</em> the necessary information for taking decisions. Also, the HighLevelController changes the state of the LowLevelAgent. (Making it move, changing its properties, other agent&#39;s properties, interaction, etc.).</p>

<p>The following diagram may help to understand how MASSIS is structured:
<img src="http://i.imgur.com/SBuHKz7.png" alt=""></p></li>
<li><p>What is the <em>metadata</em> parameter?</p>

<p>The <code>metadata</code> map is the map containing all the key-value entries that are introduced in the agent through the environment editor. Depending on the complexity of the behavior, the agent may need additional parameters.</p></li>
<li><p>...And the resources folder?</p>

<p>The agent may need external resources (like a plan definition), or maybe the function of that agent is to write something. The <code>resourcesfolder</code> parameter is the folder in where the I/O of the agent should be done.</p></li>
<li><p>What is the <code>stop()</code> method for?</p>

<p>Before the simulation finishes (or the agent is shut down), the <code>stop()</code> method is called. Can be seen as the last call to the <code>step()</code> method.</p></li>
<li><p>And the <code>step()</code> method?</p>

<p>The <code>step()</code> method is where the agent&#39;s logic occurs. Every simulation step provokes a call to the agent&#39;s step method. Changing the content of this method changes the behavior of the agent.</p></li>
</ol>

<h1 id="bringing-the-agent-the-ability-to-move-randomly">Bringing the agent the ability to move (randomly)</h1>

<p>Let&#39;s make our agent move. For accomplishing that, the highlevel controller needs the knowledge of the environment that is provided by the LowLevelAgent (such as the room where the agent is), and needs to <em>command</em> things to it&#39;s low-level representation. The <em>LowLevelAgent</em> interface provides the necessary methods for accomplishing that. Remember that the code is <a href="https://github.com/rpax/MASSIS">hosted on github</a>, so you can check what are <a href="https://github.com/rpax/MASSIS/blob/master/massisframework/massis/massis-core/src/main/java/com/massisframework/massis/model/agents/LowLevelAgent.java">the methods offered by a LowLevelAgent</a>.</p>

<p>What we are going to do is the following:</p>

<ol>
<li><p>Obtain in which room is the agent.
Rooms are represented by the  <a href="https://github.com/rpax/MASSIS/blob/master/massisframework/massis/massis-core/src/main/java/com/massisframework/massis/model/building/SimRoom.java"><code>SimRoom</code></a> class. Obtaining the room of the agent can be done by calling the <code>getRoom()</code> method:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/*1*/ SimRoom currentRoom=this.agent.getRoom();
</code></pre></div></li>
<li><p>Select a random location in that room. Locations in the environment are represented by the <a href="https://github.com/rpax/MASSIS/blob/master/massisframework/massis/massis-core/src/main/java/com/massisframework/massis/model/location/Location.java"><code>Location</code></a> class.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/*2*/ Location randomLocation = currentRoom.getRandomLoc();
</code></pre></div></li>
<li><p>Make the agent move to that point.</p>

<ol>
<li><p>The agent needs a target to follow. We will model that as an attribute of the High-Level controller.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/*3*/ private Location currentTarget;
</code></pre></div></li>
<li><p>The easiest way for approaching to one location is calling to the method <code>approachTo</code>.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/**
* Tries to approach to an specific {@link Location} in the building.
* &lt;p&gt;This method &lt;b&gt;does not&lt;/b&gt; &quot;Move&quot; the agent to one location to
* another instantly. Instead, the agent tries to be closer to the location
* given, avoiding obstacles.&lt;/p&gt;
* &lt;p&gt;
* For moving the agent to one location &lt;i&gt;instantly&lt;/i&gt; the method
* {@link #moveTo(rpax.massis.model.location.Location)} should be used
* instead
*
* @param location the target {@link Location}
* @return if the agent has reached the location or not
*/
public void approachTo(Location location,ApproachCallback callback);
</code></pre></div>
<p>This method requires an <code>ApproachCallback</code>. The <code>Ã€pproachCallback</code> methods will be called when the pathfinding process has been finished in the current step. In our case,</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ApproachCallback callback = new ApproachCallback() {

    @Override
    public void onTargetReached(LowLevelAgent agent) {
        // Target has been reached.
    }

    @Override
    public void onSucess(LowLevelAgent agent) {
        // Ok, there was no problem. The agent has moved a little bit.
    }

    @Override
    public void onPathFinderError(PathFinderErrorReason reason) {
        //Error!
        Logger.getLogger(MyHelloHighLevelController.class.getName())
        .log(Level.SEVERE,
        &quot;Error when approaching to {0} Reason: {1}&quot;,
        new Object[] { currentTarget, reason });
    }
};
</code></pre></div>
<p>Putting all together in the <code>step()</code> method,</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">@Override
public void step() {

    if (this.currentTarget == null) {
        /* 1 */ SimRoom currentRoom = this.agent.getRoom();
        /* 2 */ Location randomLocation = currentRoom.getRandomLoc();
        this.currentTarget = randomLocation;
    }
    ApproachCallback callback = new ApproachCallback() {

    @Override
        public void onTargetReached(LowLevelAgent agent) {
        // Target has been reached.
        }

        @Override
        public void onSucess(LowLevelAgent agent) {
            // Ok, there was no problem.
            //The agent has moved a little bit.
        }

        @Override
        public void onPathFinderError(PathFinderErrorReason reason) {
            // Error!
            Logger.getLogger(MyHelloHighLevelController.class.getName())
            .log(Level.SEVERE,
            &quot;Error when approaching to {0} Reason: {1}&quot;,
            new Object[] { currentTarget, reason });
        }
    };

    this.agent.approachTo(this.currentTarget, callback);
}
</code></pre></div></li>
</ol></li>
</ol>

<p>You can try launching the simulation again. The agent is moving! But it only has a target, and when that target is reached, it starts going forward and backwards, trying again and again to reach the target. We can do a little better.</p>

<p><img src="http://i.imgur.com/hHYGFYY.gif" alt=""></p>

<h1 id="moving-randomly-to-different-locations">Moving randomly to different locations</h1>

<p>In the previous code, the <code>onTargetReached()</code> method was empty. This method is called when the agent is on the target location. For creating new targets every time the agent reaches one, we can do reset <code>currentTarget</code> to <code>null</code> every time the agent reaches the <code>currentTarget</code> location.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    ApproachCallback callback = new ApproachCallback() {

        @Override
        public void onTargetReached(LowLevelAgent agent) {
            currentTarget = null;
        }

        @Override
        public void onSucess(LowLevelAgent agent) {
            // Ok, there was no problem. The agent has moved a little bit.
        }

        @Override
        public void onPathFinderError(PathFinderErrorReason reason) {
            // Error!
            Logger.getLogger(MyHelloHighLevelController.class.getName())
                    .log(Level.SEVERE,
                            &quot;Error when approaching to {0} Reason: {1}&quot;,
                            new Object[] { currentTarget, reason });

        }
    };
</code></pre></div>
<p><img src="http://i.imgur.com/KgzcWmv.gif" alt=""></p>

<p>There&#39;s a lot of things to improve! Take a look at the [Next tutorial][tutorial_4]</p>

</div>

<!--<div class="pagination">
  
    <span class="pagination-item newer">Previous</span>
  

  
    <span class="pagination-item older">Next</span>
  
</div>-->

    </div>

  </body>
</html>
